import pandas as pd
import numpy as np 

test_data = {
    "last": [242.43, 236.59, 234.14, 233.02, 237.61, 228.01, 229.73, 222.40, 223.58,
              223.41, 222.54, 229.61, 238.00, 239.10, 237.33, 235.74, 227.76, 232.54,
                232.21, 232.96, 227.38, 227.65, 232.62, 236.87, 241.53],
    "day_date_key": ["2025-01-09", "2025-01-10", "2025-01-13", "2025-01-14", "2025-01-15", "2025-01-16", "2025-01-17", "2025-01-20", "2025-01-21",
            "2025-01-22", "2025-01-23", "2025-01-24", "2025-01-27", "2025-01-28", "2025-01-29", "2025-01-30", "2025-01-31", "2025-02-03",
              "2025-02-04", "2025-02-05", "2025-02-06", "2025-02-07", "2025-02-10", "2025-02-11", "2025-02-12"],
              "updated_at": ["2025-01-09T04:30:01.000000Z", "2025-01-10T04:30:01.000000Z", "2025-01-13T04:30:01.000000Z", "2025-01-14T04:30:01.000000Z",
                              "2025-01-15T04:30:01.000000Z", "2025-01-16T04:30:01.000000Z", "2025-01-17T04:30:01.000000Z", "2025-01-20T04:30:01.000000Z", "2025-01-21T04:30:01.000000Z",
            "2025-01-22T04:30:01.000000Z", "2025-01-23T04:30:01.000000Z", "2025-01-24T04:30:01.000000Z", "2025-01-27T04:30:01.000000Z", "2025-01-28T04:30:01.000000Z",
              "2025-01-29T04:30:01.000000Z", "2025-01-30T04:30:01.000000Z", "2025-01-31T04:30:01.000000Z", "2025-02-03T04:30:01.000000Z",
              "2025-02-04T04:30:01.000000Z", "2025-02-05T04:30:01.000000Z", "2025-02-06T04:30:01.000000Z", "2025-02-07T04:30:01.000000Z", "2025-02-10T04:30:01.000000Z",
                "2025-02-11T04:30:01.000000Z", "2025-02-12T04:30:01.000000Z"],
    "change": [None, -5.84, -2.45, -1.12, 4.58, -9.60, 1.72, -7.33, 1.19, -0.17, -0.88, 7.07, 8.39, 1.10,
                -1.77, -1.59, -7.98, 4.78, -0.33, 0.75, -5.58, 0.27, 4.97, 4.25, 4.66],
    "code": ["CBA", "CBA", "CBA", "CBA", "CBA","CBA", "CBA", "CBA", "CBA", "CBA","CBA",
              "CBA", "CBA", "CBA", "CBA","CBA", "CBA", "CBA", "CBA", "CBA","CBA", "CBA", "CBA", "CBA", "CBA"],
    "company_sector": 25*["Financials"],
    "ytd_percent_change": 25*[5],
    "month_percent_change": 25*[3],
    'week_percent_change': 25*[2],
    'title': ["Commonwealth Bank of Australia"]*25,
    
    'RSI_test_value': 14*[None] + [ 45.20, 43.80, 37.48, 42.81, 42.54, 43.41, 38.70, 39.05, 45.14, 49.78, 54.33]
}
fixed_time = "T04:40:00.000000Z"
dates = pd.date_range(start="2025-01-13", periods=20, freq="B")
RSI_test_data2 = {
    "code": ["TEST123"] * 20,  # Example stock code
    "title": ["This is a test share"]*20,
    "company_sector": ["mining"]*20,
    "ytd_percent_change": 20*[10],
    "month_percent_change": 20*[7],
    'week_percent_change': 20*[69],
    "day_date_key": [d.strftime(f"%Y-%m-%d") for d in dates],
    "updated_at": [d.strftime(f"%Y-%m-%d{fixed_time}") for d in dates],
    "last": [100, 102, 101, 105, 107, 106, 108, 110, 109, 111, 113, 115, 114, 112, 113, 116, 118, 120, 119, 121],  # Closing prices
    "change": [np.nan, 2, -1, 4, 2, -1, 2, 2, -1, 2, 2, 2, -1, -2, 1, 3, 2, 2, -1, 2],  # Daily price changes
    "RSI_test_value": [np.nan] * 14 + [76.0, 78.74, 80.4, 81.8, 78.6, 80.3],  # Expected RSI values
}




#     last aest_day_datetime        RSI_test_value  change  \ avg_loss RSI_window_14_periods_14  avg_gain_window_14_periods_14  \     avg_loss_window_14_periods_14  
# 0   242.43        2025-01-09             NaN     NaN            NaN            NaN                            NaN                              NaN  
# 1   236.59        2025-01-10             NaN   -5.84            NaN            NaN                            NaN                              NaN  
# 2   234.14        2025-01-13             NaN    2.45            NaN            NaN                            NaN                              NaN  
# 3   233.02        2025-01-14             NaN   -1.12            NaN            NaN                            NaN                              NaN  
# 4   237.61        2025-01-15             NaN    4.58            NaN            NaN                            NaN                              NaN  
# 5   228.01        2025-01-16             NaN   -9.60            NaN            NaN                            NaN                              NaN  
# 6   229.73        2025-01-17             NaN    1.72            NaN            NaN                            NaN                              NaN  
# 7   222.40        2025-01-20             NaN   -7.33            NaN            NaN                            NaN                              NaN  
# 8   223.58        2025-01-21             NaN    1.19            NaN            NaN                            NaN                              NaN  
# 9   223.41        2025-01-22             NaN   -0.17            NaN            NaN                            NaN                              NaN  
# 10  222.54        2025-01-23             NaN   -0.88           NaN            NaN                            NaN                              NaN       
# 11  229.61        2025-01-24             NaN    7.07           NaN            NaN                            NaN                              NaN       
# 12  238.00        2025-01-27             NaN    8.39           NaN            NaN                            NaN                              NaN       
# 13  239.10        2025-01-28             NaN    1.10      1.781429      51.516330                       1.892857                         1.781429       
# 14  237.33        2025-01-29           45.20   -1.77      1.907857      51.390024                       1.892857                         1.907857       
# 15  235.74        2025-01-30           43.80   -1.59      1.604286      50.088431                       1.892857                         1.604286       
# 16  227.76        2025-01-31           37.48   -7.98      2.174286      53.338061                       1.717857                         2.174286       
# 17  232.54        2025-02-03           42.81    4.78      2.094286      44.549392                       2.059286                         2.094286       
# 18  232.21        2025-02-04           42.54   -0.33      2.117857      49.273322                       1.732143                         2.117857       
# 19  232.96        2025-02-05           43.41    0.75      1.432143      45.625210                       1.785714                         1.432143       
# 20  227.38        2025-02-06           38.70   -5.58      1.830714      54.885275                       1.662857                         1.830714       
# 21  227.65        2025-02-07           39.05    0.27      1.307143      48.133337                       1.682143                         1.307143       
# 22  232.62        2025-02-10           45.15    4.97      1.307143      56    .552707                       1.952143                         1.307143       
# 23  236.87        2025-02-11           49.78    4.25      1.295000      60.175766                       2.255714                         1.295000       
# 24  241.53        2025-02-12           54.33    4.66      1.232143      63.851255                       2.588571                         1.232143       
 